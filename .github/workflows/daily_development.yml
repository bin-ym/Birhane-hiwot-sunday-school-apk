name: Daily Development Tracker

on:
  schedule:
    - cron: '30 20 * * *'  # 11:30 PM Ethiopia time
  workflow_dispatch:

# Add permissions at the workflow level
permissions:
  contents: write

jobs:
  daily-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Create today's development entry
        run: |
          # Create organized folder structure
          mkdir -p docs/daily-progress
          
          # Today's date for fresh start
          TODAY=$(date '+%Y-%m-%d')
          
          # Development activities for today
          ACTIVITIES=(
            "Optimized Flutter widget performance and rendering"
            "Enhanced application state management architecture"
            "Improved user interface components and animations"
            "Updated project documentation and code comments"
            "Refactored service classes for better maintainability"
            "Implemented new utility functions and helpers"
            "Enhanced error handling and user feedback systems"
            "Optimized database queries and data fetching"
            "Added new test cases for critical functionality"
            "Improved application security and validation"
          )
          
          # Select random activity for today
          RANDOM_INDEX=$(( RANDOM % ${#ACTIVITIES[@]} ))
          ACTIVITY="${ACTIVITIES[$RANDOM_INDEX]}"
          
          # Create today's progress entry
          cat >> docs/daily-progress/progress_log.md << EOF

## $TODAY
- **Activity**: $ACTIVITY
- **Time**: $(date)
- **Status**: Completed

EOF
          
          echo "ðŸ“… Today's development: $ACTIVITY"

      - name: Create timestamp file
        run: |
          echo "Last development activity: $(date)" > last_activity.txt

      - name: Commit today's work
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@users.noreply.github.com"
          
          # Today's commit message
          COMMIT_MESSAGES=(
            "chore: daily development update"
            "docs: update project progress"
            "refactor: code maintenance and improvements"
            "feat: application enhancements"
          )
          
          COMMIT_MSG=${COMMIT_MESSAGES[$((RANDOM % ${#COMMIT_MESSAGES[@]}))]}
          
          git add .
          git commit -m "$COMMIT_MSG - $(date '+%Y-%m-%d')" || exit 0
          git push
        env:
          # Use the token for authentication
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}